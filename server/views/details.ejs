<!DOCTYPE html>
<html>

<head>
	<%- include('parts/header') %>
	<script src="https://cdn.tiny.cloud/1/jywrs1th1xlg376cn6oruuf2oogy6cpatq0r9px4a8ppt30p/tinymce/5/tinymce.min.js"
		referrerpolicy="origin"></script>
	<script>
		tinymce.init({
		  selector: '#detail',
		  plugins: 'media, table',
		  menubar: 'insert, table',
		  toolbar: 'undo redo bold italic underline fontsizeselect media table forecolor alignleft aligncenter alignright',
		  statusbar: false,
		  fontsize_formats: '8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt',
		  height: '400px',
		});
		tinymce.init({
		  selector: '#gallery',
		  plugins: 'media, table',
		  menubar: 'insert, table',
		  toolbar: 'undo redo bold italic underline fontsizeselect media table forecolor alignleft aligncenter alignright',
		  statusbar: false,
		  fontsize_formats: '8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt',
		  height: '400px',
		});
	</script>
	<link rel="stylesheet" href="/css/register.css" type="text/css">
</head>

<body>
	<%- include('parts/adminnavbar') %>
	<div style="display:none;" id="preData"><%= data %></div>
	<h3>매물수정</h3>
	<hr color="black">
	<form id="mainForm" action="/details" method="POST">
		▷ 매물수정 &nbsp;
		<input type="text" name="query_id" id="query_id" style="display:none;">
		<input type="text" name="uploadFilelist" id="uploadFilelist" style="display:none;">
		<input type="text" name="uploadFilelist2" id="uploadFilelist2" style="display:none;">
		<select id="type" name="type">
			<option value="house">전원주택/별장/펜션</option>
			<option value="land">토지/농막</option>
			<option value="consumer">상가/음식점/빌딩</option>
			<option value="rent">전월세</option>
			<option value="factory">창고/공장</option>
			<option value="villa">아파트/빌라</option>
		</select>
		<select id="sell" name="sell">
			<option id="sell2" value="sell">매매</option>
			<option id="jeon" value="jeon">전세</option>
			<option id="rent" value="rent">월세</option>
		</select>
		<button type="button" style="position:relative;top:1px;left:5px;" onclick="openPrint()">인쇄하기</button>
		<div class="seperator"></div>
		<table class="table_normal">
			<tr>
				<td>공유상태</td>
				<td>
					<input type="radio" name="share" value="Y" id="share_yes" />ON
					<input type="radio" name="share" value="N" id="share_no" />OFF
				</td>
				<td>광고상태</td>
				<td>
					<input type="radio" name="adon" value="Y" id="adon_yes" />ON
					<input type="radio" name="adon" value="N" id="adon_no" checked />OFF
				</td>
				<td>계약상태</td>
				<td>
					<select id="contract" name="contract">
						<option value="on">계약진행</option>
						<option value="pending">계약보류</option>
						<option value="complete">계약완료</option>
					</select>
				</td>
			</tr>
		</table>
		<div style="margin:5px;"></div>
		<div style="display:flex;">
			<div>
				<table style="width:600px;margin-right:5px;">
					<tr>
						<td style="background-color: yellow;width:90px;">아이콘선택</td>
						<td style="background-color: #FFFFCC" colspan="3">
							<input type="radio" name="icon" id="icon_recommend" value="recommend" />추천
							<input type="radio" name="icon" id="icon_valley" value="valley" />계곡인접
							<input type="radio" name="icon" id="icon_garden" value="garden" />넓은정원
							<input type="radio" name="icon" id="icon_urgent" value="urgent" />급매
							<input type="radio" name="icon" id="icon_national" value="national" />국유지
							<input type="radio" name="icon" id="icon_value" value="best" />Best
							<input type="radio" name="icon" id="icon_remodel" value="remodel" />리모델링
							<input type="radio" name="icon" id="icon_outbuilding" value="outbuilding" />별채
							<input type="radio" name="icon" id="icon_interior" value="interior" />인테리어
							<input type="radio" name="icon" id="icon_luxury" value="luxury" />럭셔리
							<input type="radio" name="icon" id="icon_done" value="done" />계약완료
							<input type="radio" name="icon" id="icon_almost" value="almost" />계약임박
							<input type="radio" name="icon" id="icon_new" value="new" />신축
							<input type="radio" name="icon" id="icon_not_used" value="not_used" />사용안함
						</td>
					</tr>
					<tr>
						<td style="background-color: brown;">광고종류</td>
						<td colspan="3">
							<input type="checkbox" name="ad" id="ad_gallery2" value="gallery" />갤러리매물
							<input type="checkbox" name="ad" id="ad_recommended" value="recommended" />추천매물
							<input type="checkbox" name="ad" id="ad_urgent" value="urgent" />급매물
							<input type="checkbox" name="ad" id="ad_premium" value="premium" />프리미엄매물
							<input type="checkbox" name="ad" id="ad_new2" value="new" />신규매물
							<input type="checkbox" name="ad" id="ad_theme" value="theme" />테마
							<input type="checkbox" name="ad" id="ad_land" value="land" />토지
						</td>
					</tr>
					<tr>
						<td>테마선택</td>
						<td colspan="3">
							<input type="checkbox" name="theme" id="theme_landscape" value="landscape" />조경우수
							<input type="checkbox" name="theme" id="theme_scene" value="scene" />경관우수
							<input type="checkbox" name="theme" id="theme_river" value="river" />강조망
							<input type="checkbox" name="theme" id="theme_south" value="south" />남향
							<input type="checkbox" name="theme" id="theme_mountainside" value="mountainside" />산자락
							<input type="checkbox" name="theme" id="theme_private" value="private" />사생활보호
							<input type="checkbox" name="theme" id="theme_school" value="school" />학교인근
							<input type="checkbox" name="theme" id="theme_valley" value="valley" />계곡인접
							<input type="checkbox" name="theme" id="theme_subway" value="subway" />지하철도보
							<input type="checkbox" name="theme" id="theme_flatland" value="flatland" />평지
							<input type="checkbox" name="theme" id="theme_complex" value="complex" />단지형
							<input type="checkbox" name="theme" id="theme_traditional" value="traditional">한옥
						</td>
					</tr>
					<tr>
						<td>담당자</td>
						<td colspan="3">
							<select id="user" name="user">
								<% for(let i = 0 ; i < user.length ; i++){ %>
								<option value="<%= user[i].name %>"><%= user[i].explanation %> (<%=user[i].name %>)</option>
								<% } %>
							</select>
						</td>
					</tr>
					<tr>
						<td>매물번호</td>
						<td colspan="3">
							<input type="text" id="id_letter" name="id_letter" />
							<input type="text" id="id_number" name="id_number" />
						</td>
					</tr>
					<tr>
						<td>광고제목</td>
						<td colspan="3">
							<input type="text" style="width:350px;" id="title" name="title" />
						</td>
					</tr>
					<tr>
						<td>광고주소</td>
						<td colspan="3">
							<input type="text" id="address_si" name="address_si" value="경기" placeholder="시/도" />
							<input type="text" id="address_gun" name="address_gun" value="양평군" placeholder="군" />
							<input type="text" id="address_up" name="address_up" placeholder="읍/면/동" />
							<input type="text" id="address_li" name="address_li" placeholder="리" />
							<br />
							<input type="text" id="address_bunji1" name="address_bunji1" />
							-
							<input type="text" id="address_bunji2" name="address_bunji2" />
							번지
						</td>
					</tr>
					<tr id="1">
						<td>대지면적</td>
						<td colspan="3">
							<input type="number" step="0.001" id="area_ground" name="area_ground" /> py (
							<input type="number" step="0.001" id="area_ground2" name="area_ground2" />m2 )
						</td>
					</tr>
					<tr id="2">
						<td>건물연면적</td>
						<td colspan="3">
							<input type="number" step="0.001" id="area_building" name="area_building" /> py (
							<input type="number" step="0.001" id="area_building2" name="area_building2" />m2 )
						</td>
					</tr>
					<tr id="3">
						<td>방 수</td>
						<td>
							<input type="number" step="0.001" id="area_rooms" name="area_rooms" /> 개
						</td>
						<td>욕실수</td>
						<td>
							<input type="number" step="0.001" id="area_toilets" name="area_toilets" /> 개
						</td>
					</tr>
					<tr id="4" style="display:none;">
						<td>추천용도</td>
						<td>
							<input type="text" id="area_recommended" name="area_recommended" />
						</td>
						<td>용도지역</td>
						<td>
							<input type="text" id="area_use" name="area_use" />
							<select id="area_use2" class="selectDummy">
								<option value="">선택</option>
								<option value="계획관리지역">계획관리지역</option>
								<option value="보전관리지역">보전관리지역</option>
								<option value="생산관리지역">생산관리지역</option>
								<option value="농업진흥구역">농업진흥구역</option>
								<option value="농업보호구역">농업보호구역</option>
								<option value="자연환경보전지역">자연환경보전지역</option>
								<option value="도시지역">도시지역</option>
								<option value="주거지역">주거지역</option>
							</select>
						</td>
					</tr>
					<tr id="5" style="display:none;">
						<td>지목</td>
						<td>
							<input type="text" id="area_using" name="area_using" />
							<select id="area_using2" class="selectDummy">
								<option value="">선택</option>
								<option value="대">대</option>
								<option value="임야">임야</option>
								<option value="전">전</option>
								<option value="답">답</option>
								<option value="과수원">과수원</option>
								<option value="목장용지">목장용지</option>
								<option value="잡종지">잡종지</option>
								<option value="창고용지">창고용지</option>
								<option value="도로">도로</option>
							</select>
						</td>
						<td>방향</td>
						<td>
							<input id="area_orientation" type="text" name="area_orientation" />
							<select id="area_orientation2" class="selectDummy" />
							<option value="남향" />남향</option>
							<option value="남동향" />남동향</option>
							<option value="남서향" />남서향</option>
							<option value="북향" />북향</option>
							<option value="북서향" />북서향</option>
							<option value="북동향" />북동향</option>
							<option value="동향" />동향</option>
							<option value="서향" />서향</option>
							</select>
						</td>
					</tr>
					<tr id="6" style="display:none;">
						<td>용적률</td>
						<td>
							<input type="number" step="0.001" id="area_yong" name="area_yong" />
						</td>
						<td>건폐율</td>
						<td>
							<input type="number" step="0.001" id="area_gun" name="area_gun" />
						</td>
					</tr>
					<tr id="7" style="display:none;">
						<td>접근도로</td>
						<td>
							<input type="text" id="area_road" name="area_road" />
						</td>
						<td>주요도로</td>
						<td>
							<input type="text" id="area_mainroad" name="area_mainroad" />
						</td>
					</tr>
				</table>
			</div>
			<div class="display:flex;flex-direction:column;">
				<div>
					<table style="width:500px;" border="1">
						<tr id="21">
							<td width="100px;">매매가</td>
							<td>
								<input type="number" step="0.001" id="price_sell" name="price_sell" /> 만원
							</td>
						</tr>
						<tr id="22" style="display:none;">
							<td width="100px;">전세보증금</td>
							<td>
								<input type="number" step="0.001" id="price_jeondeposit" name="price_jeondeposit" /> 만원
							</td>
						</tr>
						<tr id="23">
							<td>융자가</td>
							<td>
								<input type="number" step="0.001" id="price_borrow" name="price_borrow" /> 만원
							</td>
						</tr>
						<tr id="24" style="display:none;">
							<td width="100px;">월세보증금</td>
							<td>
								<input type="number" step="0.001" id="price_rentdeposit" name="price_rentdeposit" /> 만원
							</td>
						</tr>
						<tr id="25" style="display:none;">
							<td>월세</td>
							<td>
								<input type="number" step="0.001" id="price_rent" name="price_rent" /> 만원
							</td>
						</tr>
						<tr id="26" style="display:none;">
							<td>보증금</td>
							<td>
								<input type="number" step="0.001" id="price_deposit" name="price_deposit" /> 만원
							</td>
						</tr>
						<tr id="27" style="display:none;">
							<td width="100px;">순익</td>
							<td>
								월순익: <input type="number" step="0.001" id="price_monthly" name="price_monthly" />% /
								년순익: <input type="number" step="0.001" id="price_yearly" name="price_yearly" /> %
							</td>
						</tr>
						<tr id="28" style="display:none;">
							<td>수익률</td>
							<td>
								<input type="number" step="0.001" id="price_margin" name="price_margin" /> %
							</td>
						</tr>
						<tr id="29" style="display:none;">
							<td>공시지가</td>
							<td>
								<input type="number" step="0.001" id="price_published" name="price_published" />
							</td>
						</tr>
						<tr id="30">
							<td>현전세</td>
							<td>
								<input type="number" step="0.001" id="price_jeon" name="price_jeon" /> 만원
							</td>
						</tr>
						<tr id="300" style="display:none;">
							<td>평단가</td>
							<td>
								<input type="number" step="0.001" id="price_unit" name="price_unit" /> 만원
							</td>
						</tr>
					</table>
				</div>
				<div style="margin:5px;"></div>
				<div id="current">
					<table style="width:500px;" border="1">
						<tr id="31">
							<td width="100px;">냉난방방식</td>
							<td>
								<input type="text" id="detail_temperature" name="detail_temperature" />
								<select id="detail_temperature2" class="selectDummy">
									<option value="">선택</option>
									<option value="심야전기">심야전기</option>
									<option value="기름">기름</option>
									<option value="LPG가스">LPG가스</option>
									<option value="지열보일러">지열보일러</option>
									<option value="연탄">연탄</option>
									<option value="화목">화목</option>
									<option value="도시가스">도시가스</option>
									<option value="전기필름">전기필름</option>
								</select>
							</td>
						</tr>
						<tr id="32">
							<td>방향</td>
							<td>
								<input type="text" id="detail_orientation" name="detail_orientation" />
								<select id="detail_orientation2" class="selectDummy">
									<option value="">선택</option>
									<option value="남향">남향</option>
									<option value="남동향">남동향</option>
									<option value="남서향">남서향</option>
									<option value="정남향">정남향</option>
									<option value="동향">동향</option>
									<option value="북서향">북서향</option>
									<option value="북동향">북동향</option>
									<option value="북향">북향</option>
									<option value="서향">서향</option>
								</select>
							</td>
						</tr>
						<tr id="33">
							<td>건축구조</td>
							<td>
								<input type="text" id="detail_structure" name="detail_structure" />
								<select id="detail_structure2" class="selectDummy">
									<option value="">선택</option>
									<option value="철근콘크리트">철근콘크리트</option>
									<option value="경량철골조">경량철골조</option>
									<option value="일반목구조">일반목구조</option>
									<option value="목조">목조</option>
									<option value="ALC블럭">ALC블럭</option>
									<option value="조적조">조적조</option>
									<option value="연와조">연와조</option>
									<option value="시멘트블럭">시멘트블럭</option>
								</select>
							</td>
						</tr>
						<tr id="34">
							<td>준공년도</td>
							<td>
								<input type="text" id="detail_date" name="detail_date" />
							</td>
						</tr>
						<tr id="35" style="display:none">
							<td>인테리어</td>
							<td>
								<input type="radio" id="detail_interior_yes" name="detail_interior" value="Y" />YES
								<input type="radio" id="detail_interior_no" name="detail_interior" value="N"
									checked />NO
							</td>
						</tr>
						<tr id="36" style="display:none">
							<td>엘리베이터</td>
							<td>
								<input type="text" id="detail_elevator" name="detail_elevator" />
							</td>
						</tr>
						<tr id="37" style="display:none">
							<td>용도지역</td>
							<td>
								<input type="text" id="detail_use" name="detail_use" />
							</td>
						</tr>
						<tr id="38" style="display:none">
							<td>사용승인일</td>
							<td>
								<input type="text" id="detail_approval" name="detail_approval" />
							</td>
						</tr>
						<tr id="39" style="display:none">
							<td>주차</td>
							<td>
								방식: <input type="text" id="detail_parking" name="detail_parking" />
								/ 대수: <input type="text" id="detail_parking2" name="detail_parking2" />
							</td>
						</tr>
						<tr id="40" style="display:none">
							<td>전화가용수</td>
							<td>
								<input type="text" id="detail_phone" name="detail_phone" />
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		<div style="display:flex;">
			<div style="margin-top:5px;width:600px;">
				<div style="background-color: brown;color:white;padding:5px;">
					<h4 style="margin:0px;">특징설명(광고용)</h4>
				</div>
				<div style="margin:5px;"></div>
				<textarea name="detail" id="detail"></textarea>
			</div>
			<div style="margin-top:5px;width:600px;">
				<div style="background-color: brown;color:white;padding:5px;">
					<h4 style="margin:0px;">갤러리설명</h4>
				</div>
				<div style="margin:5px;"></div>
				<textarea name="gallery" id="gallery"></textarea>
			</div>
		</div>
		<div style="margin-top:5px;">
			<div style="background-color: brown;color:white;padding:5px; margin-bottom:5px;">
				<h4 style="margin:0px;">광고용이미지 <span style="font-weight:bold;color:yellow">(한번에 100MB 업로드까지 가능 - 100MB씩 여러번 업로드)</span></h4>
			</div>
			<input type="file" id="uploadBox" name="uploadBox" multiple>
    		<div id="imagecontainer"></div>
		</div>
		<div style="margin-top:5px;">
			<div style="background-color: brown;color:white;padding:5px; margin-bottom:5px;">
				<h4 style="margin:0px;">특징설명 (관리자용)</h4>
			</div>
			<textarea name="memo" id="memo" style="width:600px;height:180px;"></textarea>
		</div>
		<div style="margin-top:5px;">
			<div style="background-color: brown;color:white;padding:5px; margin-bottom:5px;">
				<h4 style="margin:0px;">관리자이미지 <span style="font-weight:bold;color:yellow">(한번에 100MB 업로드까지 가능 - 100MB씩 여러번 업로드)</span></h4>
			</div>
			<input type="file" id="uploadBox2" name="uploadBox2" multiple>
    		<div id="imagecontainer2"></div>
		</div>
	</form>
	<button style="margin-top:10px;" onclick="submitHandler()">제출</button>
	<footer>
		<%- include('parts/footer2') %>
	</footer>
</body>
<script>

	var g1 = document.getElementById('area_ground');
	var g2 = document.getElementById('area_ground2');
	var b1 = document.getElementById('area_building');
	var	b2 = document.getElementById('area_building2');

	var p1 = document.getElementById('price_sell');
	var p2 = document.getElementById('price_unit')
	
	p1.addEventListener('change',function(){
		if(g1.value===''){

		}else{
			p2.value = Math.round(p1.value/g1.value);
		}
	})

	g1.addEventListener('change',function(){
		g2.value = Math.round(g1.value * 3.3058);
	});

	g2.addEventListener('change',function(){
		g1.value = Math.round(g2.value * 0.3025);
	})

	b1.addEventListener('change',function(){
		b2.value = Math.round(b1.value * 3.3058);
	});

	b2.addEventListener('change',function(){
		b1.value = Math.round(b2.value * 0.3025);
	})

	var classLength = document.getElementsByClassName('selectDummy').length;
	for(let i = 0 ; i < classLength ; i++){
		document.getElementsByClassName('selectDummy')[i].addEventListener('change',function(){
			document.getElementById(document.getElementsByClassName('selectDummy')[i].id.slice(0,-1)).value = document.getElementsByClassName('selectDummy')[i].value;
		});
	}

	var preData = JSON.parse(document.getElementById('preData').innerHTML);
	let imageCount = 0;
	let uploadFilelist = [];
	let imageCount2 = 0;
	let uploadFilelist2 = [];

	function openPrint(){
		window.open('/item?id='+preData[0]._id,"myWindow",'width=1000,height=1000');
	}

	for(let i = 0 ; i < preData[0].image.length ; i++){
		if(preData[0]['image'][i]!==undefined) {
			addElement();
			uploadFilelist[i] = preData[0]['image'][i];
			document.getElementById('preview'+i).src = '/images/' + preData[0].image[i];
			document.getElementById('preview'+i).addEventListener('click',function(){
				var url = '/images' + preData[0]['image'][i];
				var img = '<img src="' + url + '">';
				var popup = window.open();
				popup.document.write(img);
			})
		}
	}
	updateUploadFilelist();

	for(let i = 0 ; i < preData[0].image2.length ; i++){
		if(preData[0]['image2'][i]!==undefined) {
			addElement2();
			uploadFilelist2[i] = preData[0]['image2'][i];
			document.getElementById('2preview'+i).src = '/images/' + preData[0].image2[i];
			document.getElementById('2preview'+i).addEventListener('click',function(){
				var url = '/images'+preData[0]['image2'][i];
				var img = '<img src="' + url + '">';
				var popup = window.open();
				popup.document.write(img);
				// popup.print();
				// window.open('/images'+preData[0]['image2'][i],"window",'width=1000,height=700');
			})
		}
	}
	updateUploadFilelist2();

	function updateUploadFilelist(){
		document.getElementById('uploadFilelist').value = uploadFilelist;
	}

	function updateUploadFilelist2(){
		document.getElementById('uploadFilelist2').value = uploadFilelist2;
	}

	function x(given) {
		return document.getElementById(given);
	}

	function insertValue(given, p) {
		for (let i = 0; i < given.length; i++) {
			x(given[i]).value = p[0][given[i]];
		}
	}
	
	if (preData[0].share === 'Y') x('share_yes').checked = true;
	else x('share_no').checked = true;
	if (preData[0].adon === 'Y') x('adon_yes').checked = true;
	else x('adon_no').checked = true;
	if (preData[0].detail_interior === 'Y') x('detail_interior_yes').checked = true;
	else x('detail_interior_no').checked = true;

	if (preData[0].icon !== '') x('icon_' + preData[0].icon).checked = true;
	for (let i = 0; i < preData[0].ad.length; i++) {
		if (!(preData[0].ad[i] === '')) x('ad_' + preData[0].ad[i] + (preData[0].ad[i] === 'new' || preData[0].ad[i] === 'gallery' ? '2' : '')).checked = true;
	}
	for (let i = 0; i < preData[0].theme.length; i++) {
		if (!(preData[0].theme[i] === '')) x('theme_' + preData[0].theme[i]).checked = true;
	}

	let values = ['type', 'sell', 'contract', 'user', 'id_letter', 'id_number', 'title', 'address_si', 'address_gun', 'address_up', 'address_li', 'address_bunji1', 'address_bunji2', 'area_ground', 'area_ground2', 'area_building', 'area_building2', 'area_rooms', 'area_toilets', 'area_recommended', 'area_use', 'area_using', 'area_orientation', 'area_yong', 'area_gun', 'area_road', 'area_mainroad', 'price_sell', 'price_jeondeposit', 'price_borrow', 'price_rentdeposit', 'price_rent', 'price_deposit', 'price_monthly', 'price_yearly', 'price_margin', 'price_published', 'price_jeon', 'price_unit', 'detail_temperature', 'detail_orientation', 'detail_structure', 'detail_date', 'detail_elevator', 'detail_use', 'detail_approval', 'detail_parking', 'detail_parking2', 'detail_phone', 'memo'];
	insertValue(values, preData);
	document.getElementById('query_id').value = preData[0]._id;
	changes();
	changes2();

    document.getElementById('uploadBox').addEventListener('change',function(){
        // extract files and make element, assign file to element input, assign picture to image
        // console.log(this.files);
        if(this.files){
            for(var i = 0 ; i < this.files.length ; i++){
                addElement();
                const reader = new FileReader();
                var imageee = document.getElementById('preview'+(imageCount-1));
                reader.onload = (function(aImg){ return function(e){aImg.src=e.target.result;};})(imageee);
                reader.readAsDataURL(this.files[i]);
                uploadFilelist.push(this.files[i]);
            }
            // console.log(uploadFilelist);
        }
	});
	
	document.getElementById('uploadBox2').addEventListener('change',function(){
        // extract files and make element, assign file to element input, assign picture to image
        // console.log(this.files);
        if(this.files){
            for(var i = 0 ; i < this.files.length ; i++){
                addElement2();
                const reader = new FileReader();
                var imageee = document.getElementById('2preview'+(imageCount2-1));
                reader.onload = (function(aImg){ return function(e){aImg.src=e.target.result;};})(imageee);
                reader.readAsDataURL(this.files[i]);
                uploadFilelist2.push(this.files[i]);
            }
            // console.log(uploadFilelist);
        }
    });

    function submitHandler(){
        var xhr = new XMLHttpRequest();
        xhr.open("POST",'/detailsimage',true);
        var form_data = new FormData();
        for(let i = 0 ; i < uploadFilelist.length; i++){
            form_data.append('image',uploadFilelist[i]);
		}
		form_data.append('_id', preData[0]._id);
		for(let i = 0 ; i < uploadFilelist.length ; i++){
			if(typeof uploadFilelist[i] !== 'string'){
				uploadFilelist[i] = uploadFilelist[i].filename;
			}
		}
		form_data.append('uploadFilelist', uploadFilelist);
        // form_data.append('name','hello');
        // console.log(form_data);
		window.setTimeout(()=>{
			xhr.send(form_data);
		},500);

		var xhr2 = new XMLHttpRequest();
		xhr2.open("POST",'/detailsimage2',true);
		var form_data2 = new FormData();
		for(let i = 0 ; i < uploadFilelist2.length ; i++){
			form_data2.append('image',uploadFilelist2[i]);
		}
		form_data2.append('_id',preData[0]._id);
		for(let i = 0; i < uploadFilelist2.length ; i++){
			if(typeof uploadFilelist2[i] !== 'string'){
				uploadFilelist2[i] = uploadFilelist2[i].filename;
			}
		}
		form_data2.append('uploadFilelist2', uploadFilelist2);
		
		window.setTimeout(()=>{
			xhr2.send(form_data2);
		}, 1500);

		
		document.getElementById('mainForm').submit();
    }

    function insertAfter(referenceNode, newNode) {
      referenceNode.parentNode.insertBefore(newNode, referenceNode.nextSibling);
    }

    Element.prototype.remove = function() {
    this.parentElement.removeChild(this);
    }
    NodeList.prototype.remove = HTMLCollection.prototype.remove = function() {
        for(var i = this.length - 1; i >= 0; i--) {
            if(this[i] && this[i].parentElement) {
                this[i].parentElement.removeChild(this[i]);
            }
        }
    }

    function addElement(){
        var divv = document.createElement('div');
        divv.id='divv'+imageCount;
        divv.classList.add('uploadDiv');
        var div2 = document.createElement('div');
        div2.innerHTML = imageCount;
        div2.style.display = 'none';
        divv.appendChild(div2);
        var imagee = document.createElement('img');
		imagee.src = '/assets/empty.gif';
		imagee.classList.add('uploadimage');
		imagee.style.cursor = 'pointer;'
        imagee.id = 'preview' + imageCount;
        divv.appendChild(imagee);
        divv.appendChild(document.createElement('br'));
        var leftButton = document.createElement('button');
        var rightButton = document.createElement('button');
        var deleteButton = document.createElement('button');
        leftButton.innerHTML = '<';
        leftButton.type = 'button';
        leftButton.style.marginRight = '5px';
        rightButton.style.marginRight = '5px';
        rightButton.innerHTML = '>';
        rightButton.type = 'button';
        deleteButton.innerHTML = '삭제';
        deleteButton.type = 'button';
        leftButton.addEventListener('click',function(){
            leftHandler(div2.innerHTML);
        });
        rightButton.addEventListener('click',function(){
            rightHandler(div2.innerHTML);
        })
        deleteButton.addEventListener('click',function(){
            deleteHandler(div2.innerHTML);
        })
        divv.appendChild(leftButton);
        divv.appendChild(rightButton);
        divv.appendChild(deleteButton);
        document.getElementById('imagecontainer').appendChild(divv);
        imageCount++;
	}
	
	function addElement2(){
        var divv = document.createElement('div');
        divv.id='2divv'+imageCount2;
        divv.classList.add('uploadDiv');
        var div2 = document.createElement('div');
        div2.innerHTML = imageCount2;
        div2.style.display = 'none';
        divv.appendChild(div2);
        var imagee = document.createElement('img');
        imagee.src = '/assets/empty.gif';
		imagee.classList.add('uploadimage');
		imagee.style.cursor = 'pointer';
		imagee.id = '2preview' + imageCount2;
        divv.appendChild(imagee);
        divv.appendChild(document.createElement('br'));
        var leftButton = document.createElement('button');
        var rightButton = document.createElement('button');
        var deleteButton = document.createElement('button');
        leftButton.innerHTML = '<';
        leftButton.type = 'button';
        leftButton.style.marginRight = '5px';
        rightButton.style.marginRight = '5px';
        rightButton.innerHTML = '>';
        rightButton.type = 'button';
        deleteButton.innerHTML = '삭제';
        deleteButton.type = 'button';
        leftButton.addEventListener('click',function(){
            leftHandler2(div2.innerHTML);
        });
        rightButton.addEventListener('click',function(){
            rightHandler2(div2.innerHTML);
        })
        deleteButton.addEventListener('click',function(){
            deleteHandler2(div2.innerHTML);
        })
        divv.appendChild(leftButton);
        divv.appendChild(rightButton);
        divv.appendChild(deleteButton);
        document.getElementById('imagecontainer2').appendChild(divv);
        imageCount2++;
    }

    var getSiblings = function (elem) {

        // Setup siblings array and get the first sibling
        var siblings = [];
        var sibling = elem.firstChild;

        // Loop through each sibling and push to the array
        while (sibling) {
            if (sibling.nodeType === 1 && sibling !== elem) {
                siblings.push(sibling);
            }
            sibling = sibling.nextSibling
        }

        return siblings;

    };

    function getCurrentIndex(index){
        var result = 0;
        var siblings = getSiblings(document.getElementById('imagecontainer'));
        for(var i = 0 ; i < siblings.length ; i++){
            if(siblings[i].id==='divv'+index){
                return i;
            }
        }
        return -1; 
	}
	
	function getCurrentIndex2(index){
        var result = 0;
        var siblings = getSiblings(document.getElementById('imagecontainer2'));
        for(var i = 0 ; i < siblings.length ; i++){
            if(siblings[i].id==='2divv'+index){
                return i;
            }
        }
        return -1; 
    }

    function leftHandler(index){
        // console.log('leftHandler ' + index);
        if(document.getElementById('divv'+index).previousSibling===null){
            return;
        }
        uploadFilelist.splice(getCurrentIndex(index)-1,0,uploadFilelist[getCurrentIndex(index)]);
        uploadFilelist.splice(getCurrentIndex(index)+1,1);
        document.getElementById('imagecontainer').insertBefore(document.getElementById('divv'+index),document.getElementById('divv'+index).previousSibling);
        // console.log(getCurrentIndex(index));
	}
	
	function leftHandler2(index){
        // console.log('leftHandler ' + index);
        if(document.getElementById('2divv'+index).previousSibling===null){
            return;
        }
        uploadFilelist2.splice(getCurrentIndex2(index)-1,0,uploadFilelist2[getCurrentIndex2(index)]);
        uploadFilelist2.splice(getCurrentIndex2(index)+1,1);
        document.getElementById('imagecontainer2').insertBefore(document.getElementById('2divv'+index),document.getElementById('2divv'+index).previousSibling);
        // console.log(getCurrentIndex(index));
    }

    function rightHandler(index){
        // console.log('rightHandler ' + index);
        if(document.getElementById('divv'+index).nextSibling===null){
            return;
        }
        uploadFilelist.splice(getCurrentIndex(index)+2,0,uploadFilelist[getCurrentIndex(index)]);
        uploadFilelist.splice(getCurrentIndex(index),1);
        // console.log(uploadFilelist);
        insertAfter(document.getElementById('divv'+index).nextSibling,document.getElementById('divv'+index))
	}
	
	function rightHandler2(index){
        // console.log('rightHandler ' + index);
        if(document.getElementById('2divv'+index).nextSibling===null){
            return;
        }
        uploadFilelist2.splice(getCurrentIndex2(index)+2,0,uploadFilelist2[getCurrentIndex2(index)]);
        uploadFilelist2.splice(getCurrentIndex2(index),1);
        // console.log(uploadFilelist);
        insertAfter(document.getElementById('2divv'+index).nextSibling,document.getElementById('2divv'+index))
    }

    function deleteHandler(index){
        // console.log('deleteHandler ' + index);
        uploadFilelist.splice(getCurrentIndex(index),1);
        document.getElementById('divv'+index).remove();
        //console.log(uploadFilelist);
	}
	
	function deleteHandler2(index){
        // console.log('deleteHandler ' + index);
        uploadFilelist2.splice(getCurrentIndex2(index),1);
        document.getElementById('2divv'+index).remove();
        //console.log(uploadFilelist);
    }


	window.onload = function () {
		tinymce.get('detail').setContent(preData[0].detail.replace(/&gt;/gi, '>').replace(/&lt;/gi, '<'));
		tinymce.get('gallery').setContent(preData[0].gallery.replace(/&gt;/gi, '>').replace(/&lt;/gi, '<'));
	}

	function changes() {
		var selectType = document.getElementById('type');
		var selectSell = document.getElementById('sell');
		if (selectType.value === 'house' || selectType.value === 'factory' || selectType.value === 'villa' || selectType.value==='rent') {
			if (selectSell.value === 'sell') {
				document.getElementById('21').style.display = "";
				document.getElementById('22').style.display = "none";
				document.getElementById('23').style.display = "";
				document.getElementById('24').style.display = "none";
				document.getElementById('25').style.display = "none";
				document.getElementById('26').style.display = "none";
				document.getElementById('27').style.display = "none";
				document.getElementById('28').style.display = "none";
				document.getElementById('29').style.display = "none";
				document.getElementById('30').style.display = "";
				document.getElementById('300').style.display = "none";
			} else if (selectSell.value === "jeon") {
				document.getElementById('21').style.display = "none";
				document.getElementById('22').style.display = "";
				document.getElementById('23').style.display = "";
				document.getElementById('24').style.display = "none";
				document.getElementById('25').style.display = "none";
				document.getElementById('26').style.display = "none";
				document.getElementById('27').style.display = "none";
				document.getElementById('28').style.display = "none";
				document.getElementById('29').style.display = "none";
				document.getElementById('30').style.display = "none";
				document.getElementById('300').style.display = "none";
			} else {
				document.getElementById('21').style.display = "none";
				document.getElementById('22').style.display = "none";
				document.getElementById('23').style.display = "none";
				document.getElementById('24').style.display = "";
				document.getElementById('25').style.display = "";
				document.getElementById('26').style.display = "none";
				document.getElementById('27').style.display = "none";
				document.getElementById('28').style.display = "none";
				document.getElementById('29').style.display = "none";
				document.getElementById('30').style.display = "none";
				document.getElementById('300').style.display = "none";
			}
		} else if (selectType.value === 'land') {
			document.getElementById('21').style.display = "";
			document.getElementById('22').style.display = "none";
			document.getElementById('23').style.display = "";
			document.getElementById('24').style.display = "none";
			document.getElementById('25').style.display = "none";
			document.getElementById('26').style.display = "none";
			document.getElementById('27').style.display = "none";
			document.getElementById('28').style.display = "none";
			document.getElementById('29').style.display = "none";
			document.getElementById('30').style.display = "";
			document.getElementById('300').style.display = "";
		} else {
			if (selectSell.value === 'sell') {
				document.getElementById('21').style.display = "";
				document.getElementById('22').style.display = "none";
				document.getElementById('23').style.display = "";
				document.getElementById('24').style.display = "none";
				document.getElementById('25').style.display = "none";
				document.getElementById('26').style.display = "";
				document.getElementById('27').style.display = "none";
				document.getElementById('28').style.display = "";
				document.getElementById('29').style.display = "";
				document.getElementById('30').style.display = "";
				document.getElementById('300').style.display = "none";
			} else if (selectSell.value === 'jeon') {
				document.getElementById('21').style.display = "none";
				document.getElementById('22').style.display = "";
				document.getElementById('23').style.display = "";
				document.getElementById('24').style.display = "none";
				document.getElementById('25').style.display = "none";
				document.getElementById('26').style.display = "none";
				document.getElementById('27').style.display = "none";
				document.getElementById('28').style.display = "none";
				document.getElementById('29').style.display = "none";
				document.getElementById('30').style.display = "none";
				document.getElementById('300').style.display = "none";
			} else {
				document.getElementById('21').style.display = "none";
				document.getElementById('22').style.display = "none";
				document.getElementById('23').style.display = "none";
				document.getElementById('24').style.display = "";
				document.getElementById('25').style.display = "";
				document.getElementById('26').style.display = "none";
				document.getElementById('27').style.display = "none";
				document.getElementById('28').style.display = "none";
				document.getElementById('29').style.display = "none";
				document.getElementById('30').style.display = "none";
				document.getElementById('300').style.display = "none";
			}
		}
	}

	function changes2(){
		var selectType = document.getElementById('type');
		var selectSell = document.getElementById('sell');
		if (selectType.value === 'land') {
			selectSell.value = 'sell';
			document.getElementById('sell2').style.display = 'block';
			document.getElementById('jeon').style.display = "none";
			document.getElementById('rent').style.display = "none";
		} else if(selectType.value==='rent'){
			selectSell.value = 'jeon';
			document.getElementById('sell2').style.display = 'none';
			document.getElementById('jeon').style.display = "block";
			document.getElementById('rent').style.display = "block";
		} else {
			selectSell.value = 'sell';
			document.getElementById('sell2').style.display = 'block';
			document.getElementById('jeon').style.display = "block";
			document.getElementById('rent').style.display = "block";
		}

		changes();

		if (selectType.value === 'house' || selectType.value === "factory" || selectType.value === "villa" || selectType.value === "rent") {
			document.getElementById('1').style.display = "";
			document.getElementById('2').style.display = "";
			document.getElementById('3').style.display = "";
			document.getElementById('4').style.display = "none";
			document.getElementById('5').style.display = "none";
			document.getElementById('6').style.display = "none";
			document.getElementById('7').style.display = "none";

			document.getElementById('current').style.display = "block";
			document.getElementById('31').style.display = "";
			document.getElementById('32').style.display = "";
			document.getElementById('33').style.display = "";
			document.getElementById('34').style.display = "";
			document.getElementById('35').style.display = "none";
			document.getElementById('36').style.display = "none";
			document.getElementById('37').style.display = "none";
			document.getElementById('38').style.display = "none";
			document.getElementById('39').style.display = "none";
			document.getElementById('40').style.display = "none";
		} else if (selectType.value === 'land') {
			document.getElementById('1').style.display = "";
			document.getElementById('2').style.display = "none";
			document.getElementById('3').style.display = "none";
			document.getElementById('4').style.display = "";
			document.getElementById('5').style.display = "";
			document.getElementById('6').style.display = "none";
			document.getElementById('7').style.display = "none";

			document.getElementById('current').style.display = "none";
		} else {
			document.getElementById('1').style.display = "";
			document.getElementById('2').style.display = "";
			document.getElementById('3').style.display = "";
			document.getElementById('4').style.display = "none";
			document.getElementById('5').style.display = "none";
			document.getElementById('6').style.display = "";
			document.getElementById('7').style.display = "";

			document.getElementById('current').style.display = "block";
			document.getElementById('31').style.display = "";
			document.getElementById('32').style.display = "none";
			document.getElementById('33').style.display = "none";
			document.getElementById('34').style.display = "none";
			document.getElementById('35').style.display = "";
			document.getElementById('36').style.display = "";
			document.getElementById('37').style.display = "";
			document.getElementById('38').style.display = "";
			document.getElementById('39').style.display = "";
			document.getElementById('40').style.display = "";
		}
	}

	var selectType = document.getElementById('type');
	var selectSell = document.getElementById('sell');

	selectSell.addEventListener('change', function (e) {
		changes();
	});

	selectType.addEventListener('change', function (e) {
		changes();		
		changes2();
	});
</script>

</html>