<!DOCTYPE html>
<html>
	<head>
		<%- include('parts/header') %>
		<style>
			table {
				border-collapse: collapse;
			}
			td {
				padding: 3px;
				text-align:center;
			}

			.short {
				width: 30px;
			}

			.medium {
				width: 100px;
			}

			.long {
				width: 150px;
				font-size: 12px;
			}
		</style>
	</head>
	<body>
		<div id="count" style="display:none;"><%= count %></div>
		<div id="current" style="display:none"><%= current %></div>
		<%- include('parts/adminnavbar') %>
		ê´€ë¦¬ í˜ì´ì§€ì…ë‹ˆë‹¤(ë§¤ë¬¼ìˆ˜ : <%= count %>).
		<button id="deleteItem" onclick="onClick()">ë§¤ë¬¼ì‚­ì œ</button>
		<button id="searchItem">ë§¤ë¬¼ê²€ìƒ‰</button>
		<button id="resetItem" onclick='window.location.href="/manage"'>ê²€ìƒ‰ì´ˆê¸°í™”</button>
		<button id="excelDownload" onclick='window.location.href="/excel"'>ì—‘ì…€ë¡œ ë‹¤ìš´ë¡œë“œ</button>		
		<div style="margin:5px;"></div>
		<table border="1">
			<tr>
				<form id="searchForm" action="/search" method="POST">
					<td style="background-color: #bbc8c0;">ê²€ìƒ‰</td>
					<td>xxx</td>
					<td style="width:40px;table-layout: fixed;word-break:break-all;"><input style="width:40px;" type="text" name="id"></td>
					<td style="width:30px;">
						<select style="width:30px;" name="contract">
							<option value="">ì „ì²´</option>
							<option value="on">ì§„í–‰</option>
							<option value="pending">ë³´ë¥˜</option>
							<option value="complete">ì™„ë£Œ</option>
						</select>
					</td>
					<td style="width:30px;">
						<select style="width:30px;" name="adon">
							<option value="">ì „ì²´</option>
							<option value="Y">ON</option>
							<option value="N">OFF</option>
						</select>
					</td>
					<td>
						xxx
					</td>
					<td style="width:100px;">
						<input style="width:100px;" type="text" name="title">
					</td>
					<td width="120" style="word-break: break-all;table-layout: fixed;">
						<input style="width:120px;" type="text" name="memo">
					</td>
					<td style="width:30px;">
						<select style="width:30px;" name="sell">
							<option value="">ì „ì²´</option>
							<option value="sell">ë§¤ë§¤</option>
							<option value="jeon">ì „ì„¸</option>
							<option value="rent">ì›”ì„¸</option>
						</select>
					</td>
					<td style="width:60px;">
						<select style="width:60px;" name="type">
							<option value="">ì „ì²´</option>
							<option value="house">ì „ì›ì£¼íƒ/ë³„ì¥</option>
							<option value="farm">ë†ê°€ì£¼íƒ/êµ¬ì˜¥</option>
							<option value="land">í† ì§€ë§¤ë¬¼</option>
							<option value="motel">íœì…˜/ëª¨í…”</option>
							<option value="villa">ë¹Œë¼/ì—°ë¦½/ì›ë£¸</option>
							<option value="building">ìƒê°€/ë¹Œë”©/ê¸°íƒ€</option>
						</select>
					</td>
					<td>
						<input class="short" type="text" name="address_up">
					</td>
					<td style="width:65px;">
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="price_sell_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;"><input class="short" type="text" name="price_sell_upper">ì´í•˜</div>
					</td>
					<td>
						<div style="display:flex;width:65px;font-size:10px;"><input type="text" class="short" name="price_jeon_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;""><input type="text" class="short" name="price_jeon_upper">ì´í•˜</div>
					</td>
					<td style="width:40px;">
						<input type="text" class="short" name="detail_structure">
					</td>
					<td>
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="area_ground_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;""><input type="text" class="short" name="area_ground_upper">ì´í•˜</div>
					</td>
					<td>
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="area_building_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;""><input type="text" class="short" name="area_building_upper">ì´í•˜</div>
					</td>
					<td>
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="price_deposit_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;""><input type="text" class="short" name="price_deposit_upper">ì´í•˜</div>
					</td>
					<td>
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="price_rent_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;""><input type="text" class="short" name="price_rent_upper">ì´í•˜</div>
					</td>
					<td style="width:45px;">
						<input type="text" style="width:45px;" name="detail_date">
					</td>
					<td style="width:30px;">
						<input type="text" style="width:30px;" name="detail_orientation">
					</td>
					<td>
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="area_rooms_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;""><input type="text" class="short" name="area_rooms_upper">ì´í•˜</div>
					</td>
					<td>
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="area_toilets_lower">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;margin-bottom:4px;""><input type="text" class="short" name="area_toilets_upper">ì´í•˜</div>
					</td>
					<td>
						<select name="ad">
							<option value="">ì „ì²´</option>
							<option value="gallery">ê°¤ëŸ¬ë¦¬ë§¤ë¬¼</option>
							<option value="recommended">ì¶”ì²œë§¤ë¬¼</option>
							<option value="urgent">ê¸‰ë§¤ë¬¼</option>
							<option value="premium">í”„ë¦¬ë¯¸ì—„ë§¤ë¬¼</option>
							<option value="new">ì‹ ê·œë§¤ë¬¼</option>
							<option value="theme">í…Œë§ˆ</option>
							<option value="land">í† ì§€</option> 
						</select>
					</td>
					<td>
						<input type="text" class="medium" name="timestamp_modified_upper">
						<input type="text" class="medium" name="timestamp_modified_lower">
					</td>
					<td>
						<input type="text" class="medium" name="timestamp_upper">
						<input type="text" class="medium" name="timestamp_lower">
					</td>
					<td>
						<div style="display:flex;width:60px;font-size:10px;"><input type="text" class="short" name="views_upper">ì´ìƒ</div>
						<div style="font-size:10px;position:relative;left:-2px;top:3px;"><input type="text" class="short" name="views_lower">ì´í•˜</div>
					</td>
					<input type="submit" style="display:none">
				</form>
			</tr>
			<tr style="background-color: #b1d0d3;font-weight:bolder;">
				<td><input type="checkbox" name="1" id="checkAll"></td>
				<td>ë§¤ë¬¼ìƒì„¸</td>
				<td style="width:40px;table-layout: fixed;word-break:break-all;"><div style="display:flex">ë§¤ë¬¼ë²ˆí˜¸ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=id_asc&search=<%= uuid %>">ğŸ”º</span></a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=id_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>			
				<td>ê³„ì•½</td>
				<td>ê´‘ê³ </td>
				<td style="background-color: #F9EEEE;">ê´‘ê³ ì‚¬ì§„</td>
				<td style="background-color: #F9EEEE;">ê´‘ê³ ì œëª©</td>
				<td style="width:120px;table-layout: fixed;">ê´€ë¦¬ì„¤ëª…</td>
				<td>í˜•íƒœ</td>
				<td>ë§¤ë¬¼ì¢…ë¥˜</td>
				<td>ê´‘ê³ í•´ë‹¹ë™</td>
				<td><div style="display:flex">ë§¤ë§¤ê°€ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=price_sell_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=price_sell_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td><div style="display:flex">ì „ì„¸ê°€ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=price_jeon_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=price_jeon_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td style="width:40px;">ê±´ì¶•êµ¬ì¡°</td>
				<td><div style="display:flex">ê´‘ê³ ëŒ€ì§€í‰ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_ground_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_ground_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td><div style="display:flex">ê´‘ê³ í‰ìˆ˜ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_building_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_building_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td>ë³´ì¦ê¸ˆ</td>
				<td>ì›”ì„¸</td>
				<td style="width:45px;"><div style="display:flex">ì¤€ê³µë…„ë„ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=detail_date_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=detail_date_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td style="width:30px;">ë°©í–¥</td>
				<td><div style="display:flex">ë°©ìˆ˜ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_rooms_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_rooms_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td><div style="display:flex">ìš•ì‹¤ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_toilets_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=area_toilets_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td>ê´‘ê³ ì¢…ë¥˜</td>
				<td><div style="display:flex">ìˆ˜ì •ì¼ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=timestamp_modified_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=timestamp_modified_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td><div style="display:flex">ë“±ë¡ì¼ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=timestamp_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=timestamp_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
				<td><div style="display:flex">ì¡°íšŒ <div style="display:flex;flex-direction:column;"><a style="font-size:12px;text-decoration:none;" href="/manage?sort=views_asc&search=<%= uuid %>">ğŸ”º</a><a style="font-size:12px;text-decoration:none;" href="/manage?sort=views_desc&search=<%= uuid %>">ğŸ”»</a></div></div></td>
			</tr>
			<% for(let i = 0 ; i < data.length ; i++){ %>
				<div style="display:none;" id="<%= i %>0"><%= data[i]._id %></div>
			<% } %>
			<% data.forEach(function(d, index){ %>	
						
				<tr style="background-color:<%= index%2===1?'#FEF4C9':'white' %>">					
					<td><input type="checkbox" class="1" name="1"></td>
					<td><a href="/item?id=<%= d._id %>">LINK</a></td>
					<td style="cursor:pointer;width:40px;table-layout: fixed;word-break:break-all;" onclick="location.href='details?id=<%= d._id %>'"><%= d.id %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.contract %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.adon %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><image src="/images<%= d.thumbnail %>" style="height:80px;"></td>
					<td style="width:100px;cursor:pointer;table-layout: fixed;word-break: break-all;" onclick="location.href='details?id=<%= d._id %>'"><%= d.title %></td>
					<td style="cursor:pointer;color:blue;width:120px;table-layout: fixed;word-break: break-all;" onclick="location.href='details?id=<%= d._id %>'"><%= d.memo %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.sell %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.type %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.address_up %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.price_sell %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.price_jeon %></td>
					<td style="cursor:pointer;width:40px;table-layout: fixed;word-break: break-all;" onclick="location.href='details?id=<%= d._id %>'"><%= d.detail_structure %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.area_ground %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.area_building %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.price_deposit %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.price_rent %></td>
					<td style="cursor:pointer;width:45px;table-layout: fixed;word-break: break-all;" onclick="location.href='details?id=<%= d._id %>'"><%= d.detail_date %></td>
					<td style="cursor:pointer;width:30px;table-layout: fixed;word-break: break-all;" onclick="location.href='details?id=<%= d._id %>'"><%= d.detail_orientation %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.area_rooms %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.area_toilets %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.ad %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= new Date(d.timestamp_modified).toISOString().split('T')[0] %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= new Date(d.timestamp).toISOString().split('T')[0] %></td>
					<td style="cursor:pointer;" onclick="location.href='details?id=<%= d._id %>'"><%= d.views %></td>
				</tr>
				
			<% }) %>
		</table>		
		<button id="left"><</button>
		<div id="s">
		</div>
		<button id="right">></button>
		<footer>
			<%- include('parts/footer2') %>
		</footer>
	</body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script>
		function excel(){
			$.post('/excel',function(data){
				console.log(data);
			})
		}

		document.getElementById('searchItem').addEventListener('click',function(){
			document.getElementById('searchForm').submit();
		})

		document.getElementById('checkAll').addEventListener('click',function(){
			var box = document.getElementsByClassName('1');
			for(var i = 0 ; i < box.length ; i++){
				if(!document.getElementById('checkAll').checked) box[i].checked = false;
				else box[i].checked = true;
			}
		});

		function getQueryStringValue(key) {  
  			return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));  
		}  

		function onClick(){
			var checkboxes = document.getElementsByClassName('1');
			var selected = [];
			for(var i = 0 ; i < checkboxes.length ; i++){
				if(checkboxes[i].checked){
					selected.push(document.getElementById(i+'0').innerHTML);
				}
			}
			console.log(selected);

			var form = document.createElement('form');
			form.setAttribute('method','post');
			form.setAttribute('action','/delete');
			document.charset = "utf-8";
			var hiddenField = document.createElement('input');
			hiddenField.setAttribute('type','hidden');
			hiddenField.setAttribute('name','deleteitems');
			hiddenField.setAttribute('value',selected);
			form.appendChild(hiddenField);
			document.body.appendChild(form);
			form.submit();
		}

		var r = "";
		var sortKey = getQueryStringValue('sort')===""?"":"&sort="+getQueryStringValue('sort');	
		var searchKey = getQueryStringValue('search')===""?"":"&search="+getQueryStringValue('search');	
		var current = Math.floor(document.getElementById('current').innerHTML/10);
		var documentSize = document.getElementById('count').innerHTML;
		if(documentSize<=300){
			documentSize = Math.floor(documentSize / 30);
		}else{
			documentSize = 9;
		}
		documentSize++;
		if(documentSize===1) documentSize++;

		for(var i = current * 10 + 1; i < current * 10 + 1 + documentSize; i++){
			if(document.getElementById('count').innerHTML >= 30 * (i-1) ) r += '<a href="/manage?page='+i+sortKey+searchKey+'">'+i + '</a> ';
		}
		document.getElementById('s').innerHTML = r;
		
		document.getElementById('left').addEventListener('click',function(){
			current -= 1;
			if(current===-1) current = 0;
			var result = "";
			var tmp = documentSize===2? 1 : documentSize;
			for(var i = current * 10 + 1; i < current * 10 + 1 + tmp; i++){
				result += '<a href="/manage?page='+i+sortKey+searchKey+'">'+i + '</a> ';
			}
			document.getElementById('s').innerHTML = result;
		});

		document.getElementById('right').addEventListener('click',function(){
			current += 1;
			if(current * 300 > document.getElementById('count').innerHTML) current--;
			var result = "";
			for(var i = current * 10 + 1; i < current * 10 + 1 + documentSize; i++){
				if(document.getElementById('count').innerHTML >= 30 * (i-1)) result += '<a href="/manage?page='+i+sortKey+searchKey+'">'+i + '</a> ';
			}
			document.getElementById('s').innerHTML = result;
		});
	</script>
</html>
